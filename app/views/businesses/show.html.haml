= link_to edit_business_path(@business), 
  class: 'btn btn-primary pull-right', 
  role: 'button', 
  title: th('activerecord.actions.edit') do
  = i 'pencil'
  = t 'activerecord.actions.edit'

%h1
  = @business.name
%p
  = @business.product_name.humanize
  = @business.flag
  
%h2
  = i 'bar-chart'
  = 'Statistiques'
    
%h2
  = i Business::Website.decorator_class.icon
  = "Websites"
  
%h2
  = i Partner::Request.decorator_class.icon
  = "Requests" 
  = @business.requests.count
  
- states = %w( draft sent canceled paid rejected in_progress accepted submitted published )

.table-responsive
  %table.table.table-sm.table-hover
    %thead.thead-default
      %tr
        %th Categorie
        - states.each do |state|
          %th= state.humanize
        %th Total
    %tbody
      - Partner.categories.keys.each do |category|
        %tr
          %th{scope: "row"}= category.humanize
          - total = 0
          - states.each do |state|
            - nb = Partner.joins(:requests).where('partner_requests.state = ?', state).where(category: category).count
            - total += nb
            %td= nb
          %td
            = total
            |
            = Partner.joins(:requests).where(category: category).count
      
      %tr
        %td Total
        - states.each do |state|
          %td= Partner::Request.where(state: state).count
        %td ??
  
%h2
  = i Partner::Backlink.decorator_class.icon
  = "Backlink" 
    